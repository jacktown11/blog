<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<title></title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" href="/css/article.css">
	<link rel="stylesheet" href="/css/monokai.css">
</head>

<body>
	<div id="app" class="app-wrap">

		<!-- 侧边栏显隐控制钮 -->
		<svg id="sidebar-control" class="sidebar-control" width="40" height="32" @click="isShowSidebar = !isShowSidebar">
			<g stroke="#fff" stroke-width="4" stroke-linecap="round">
				<line x1="8" y1="8" x2="32" y2="8"></line>
				<line x1="8" y1="16" x2="32" y2="16"></line>
				<line x1="8" y1="24" x2="32" y2="24"></line>
			</g>
		</svg>

		<div class="sidebar" style="display: none;" v-show="isShowSidebar">
			<!-- 目录级别控制条 -->
			<p class="level-controller">
				展开级别：
				<button @click="modifyLevel(-1)" class="level-btn level-minus">-</button>
				<span class="level-now" v-html="expandLevel"></span>
				<button @click="modifyLevel(1)" class="level-btn level-add">+</button>
			</p>

			<!-- 文章目录 -->
			<div id="catalog-container" class="catalog-container">
				<blog-catalog class="catalogs" :tree-node="tree" :expand-level="expandLevel"></blog-catalog>
			</div>

			<!-- 更多文章导航 -->
			<div class="post-nav">
				<div class="home">
					<a class="home-link" href="/">返回首页</a>
				</div>
				<div class="prev no-wrap">
					上一篇：<a href="/blog/2018/11/08/foundations-of-computer-science-note">《计算机科学导论》笔记</a>
				</div>
				<div class="next no-wrap">
					下一篇：<a href="/blog/2018/12/25/order-app-project-note">基于vue-cli3仿制饿了么WebApp项目总结</a>
				</div>
			</div>

		</div>

		<!-- 文章内容区 -->
		<div class="article-wrap" :class="{extended: !isShowSidebar}" @click="if(isNarrowScreen){hideSidebar();}">
			<article id="article-container">
				<h1 id="post-title">HTML5 新特性</h1>
				<p class="meta">2018-12-07</p>
				<div class="post" ref="post">
					<p>按：在<a href="https://jacktown11.github.io/practice/">我的练习</a>中可以找到本文中的<code>html5</code>新特性相关demo。</p>
<h1 id="html5-10">零、HTML5 新特性总览（10个）</h1>
<ul>
<li>新的语义标签和属性</li>
<li>表单新特性（表单2.0）</li>
<li>视频和音频</li>
<li>Canvas绘图</li>
<li>SVG绘图</li>
<li>地理定位</li>
<li>拖放API</li>
<li>WebWorker</li>
<li>WebStorage</li>
<li>WebSocket</li>
</ul>
<h1 id="section">一、新的语义标签和属性</h1>
<h1 id="html5">二、HTML5增强型表单</h1>
<ul>
<li><code>input</code>标签的新<code>type</code>属性</li>
<li>新的表单标签</li>
<li>表单标签的新属性</li>
</ul>
<h2 id="inputtype">1. input标签的新type属性</h2>
<h3 id="h4type">h4中的type属性</h3>
<ul>
<li><code>text</code></li>
<li><code>password</code></li>
<li><code>radio</code></li>
<li><code>checkbox</code></li>
<li><code>file</code></li>
<li><code>submit</code></li>
<li><code>reset</code></li>
<li><code>button</code></li>
<li><code>image</code></li>
<li><code>hidden</code></li>
</ul>
<h3 id="h5type">h5中新type属性</h3>
<ul>
<li><code>email</code>：邮件输入域，在表单提交时提供简单的邮箱格式验证，并弹出一个提示窗口(可定制内容不能定制样式)。<code>&lt;input type=&quot;email&quot;&gt;</code></li>
<li><code>url</code>：URL地址输入域，在表单提交时提供简单的URL地址格式验证，并弹出一个提示窗口(可定制内容不能定制样式)。<code>&lt;input type=&quot;url&quot;&gt;</code></li>
<li><code>number</code>：数字输入域，在表单提交时提供简单的数字格式验证，并弹出一个提示窗口(可定制内容不能定制样式)。<code>&lt;input type=&quot;number&quot; min=&quot;&quot; max=&quot;&quot; step=&quot;&quot;&gt;</code></li>
<li><code>tel</code>：电话号码输入域，在手机浏览器中弹出数字输入键盘。<code>&lt;input type=&quot;tel&quot;&gt;</code></li>
<li><code>search</code>：搜索输入域，在手机浏览器中右下角呈现搜索按键。<code>&lt;input type=&quot;search&quot;&gt;</code></li>
<li><code>range</code>：范围选择控件，帮助用户在一定范围内选择一个数字。<code>&lt;input type=&quot;range&quot; min=&quot;&quot; max=&quot;&quot; step=&quot;&quot;&gt;</code></li>
<li><code>color</code>：颜色选择控件，浏览器并未自己实现颜色选择框，而是使用操作系统自带的颜色选择控件。<code>&lt;input type=&quot;color&quot;&gt;</code></li>
<li><code>date</code>：日期选择控件，<code>FF</code>没有实现，推荐使用第三方插件代替，如<code>jQueryUI-datepicker</code>、<code>laydate</code>等。<code>&lt;input type=&quot;date&quot;&gt;</code></li>
<li><code>month</code>：月份选择控件，FF没有实现。<code>&lt;input type=&quot;month&quot;&gt;</code></li>
<li><code>week</code>：星期选择控件，FF没有实现。<code>&lt;input type=&quot;week&quot;&gt;</code></li>
</ul>
<h2 id="section-1">2. 新的表单标签</h2>
<ul>
<li>h4: input, button, select/option, textarea, label</li>
<li>h5: datalist, progress, meter, output</li>
</ul>
<h3 id="datalist">datalist</h3>
<p>本身不可见，它为<code>input</code>提供输入列表，用户可以从中选取，也可以手动输入。</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;datalist</span> <span class="na">id=</span><span class="s">"listA"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;option&gt;</span>xx<span class="nt">&lt;/option&gt;</span>
    <span class="nt">&lt;option&gt;</span>yy<span class="nt">&lt;/option&gt;</span>
    <span class="nt">&lt;option&gt;</span>zz<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/datalist&gt;</span>
listA: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">list=</span><span class="s">"listA"</span><span class="nt">&gt;</span>
</code></pre></div></div>
<h3 id="progress">progress</h3>
<p>进度条，有两种显示形式</p>
<ol>
<li>左右晃动的进度条</li>
<li>具有一定进度值（0-1）的进度条</li>
</ol>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- 左右摇晃的进度条 --&gt;</span>
进度条1：<span class="nt">&lt;progress&gt;&lt;/progress&gt;&lt;br&gt;</span>
<span class="c">&lt;!-- 具有进度值的进度条 --&gt;</span>
进度条2：<span class="nt">&lt;progress</span> <span class="na">value=</span><span class="s">"0"</span> <span class="na">id=</span><span class="s">"progress"</span><span class="nt">&gt;&lt;/progress&gt;&lt;br&gt;</span>
</code></pre></div></div>
<h3 id="meter">meter</h3>
<p>刻度尺，用于表示一个值所处范围：不可接受（红色），可以接受（黄色），非常优秀（绿色）</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>刻度：<span class="nt">&lt;meter</span> <span class="na">min=</span><span class="s">"0"</span> <span class="na">max=</span><span class="s">"100"</span> <span class="na">low=</span><span class="s">"60"</span> <span class="na">high=</span><span class="s">"85"</span> <span class="na">optimum=</span><span class="s">"100"</span> <span class="na">value=</span><span class="s">"0"</span> <span class="na">id=</span><span class="s">"meter"</span><span class="nt">&gt;&lt;/meter&gt;</span>
</code></pre></div></div>
<h3 id="output">output</h3>
<p>输出，语义标签，没有任何样式，样式等同于<code>span</code>。（下面的例子中表示语义，并不自动计算，也没有样式）</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>商品价格：3.5
购买数量：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"3"</span><span class="nt">&gt;</span>
小计：<span class="nt">&lt;output&gt;</span>10.5<span class="nt">&lt;/output&gt;</span>
</code></pre></div></div>
<h2 id="section-2">3. 表单标签的新属性</h2>
<ul>
<li><code>placeholder</code>: 占位符</li>
<li><code>autofocus</code>: 自动获取输入焦点</li>
<li><code>multiple</code>: 允许输入框中出现多个值</li>
<li><code>form</code>: 用于把输入域放置在<code>form</code>外部，其值为绑定到的<code>form</code>元素的<code>id</code></li>
</ul>
<p>验证相关</p>
<ul>
<li><code>required</code>: 必填项，内容不能为空</li>
<li><code>maxlength</code>: 字符串最大长度</li>
<li><code>minlength</code>: 字符串最小长度</li>
<li><code>max</code>: 指定数字的最大值</li>
<li><code>min</code>: 指定数字的最小值</li>
<li><code>pattern</code>: 正则表达式</li>
</ul>
<h1 id="section-3">三、视频和音频</h1>
<h2 id="flashh5">1. Flash被H5取代各方面</h2>
<p>|Flash技术| H5技术|
|-|-|
|绘图（AS/Flex）| Canvas/SVG|
|动画           | Canvas+(定时器，替换新技术)|
|视频和音频     | video+audio|
|客户端存储     | WebStorage|</p>
<h2 id="h5">2. H5视频</h2>
<p>提供新的标签用于播放视频，但是视频格式很多，浏览器不一定都有它们的解码器，为此通常需要提供多种选择。</p>
<p><code>video</code>本身是一个<code>300*150</code>的<code>inline-block</code>元素。</p>
<h3 id="html">html成员属性</h3>
<ul>
<li><code>autoplay</code>: <code>false</code>, 自动播放</li>
<li><code>controls</code>: <code>false</code>, 是否显示播放空间</li>
<li><code>loop</code>: <code>false</code>, 是否循环播放</li>
<li><code>muted</code>: <code>false</code>, 是否静音</li>
<li><code>poster</code>: <code>&quot;&quot;</code>, 是否在第一帧之前显示海报（图片）</li>
<li><code>preload</code>:, 视频的预加载策略，比如手机端考虑到流量问题，通常不能- <code>使用auto</code></li>
<li><code>auto</code>: 预加载视频的元数据（时长、名字等）以及缓冲一定时长的视频</li>
<li><code>metadate</code>: 预加载视频的元数据</li>
<li><code>none</code>: 不预加载任何数据</li>
</ul>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;video</span> <span class="na">src=</span><span class="s">"static/aaa.mp4"</span> <span class="na">id=</span><span class="s">"v1"</span> <span class="na">controls</span> <span class="na">poster=</span><span class="s">"static/play.png"</span> <span class="na">preload=</span><span class="s">"metadate"</span><span class="nt">&gt;&lt;/video&gt;</span>

<span class="nt">&lt;video</span> <span class="na">id=</span><span class="s">"v2"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;source</span> <span class="na">src=</span><span class="s">"static/aaa.mp4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;source</span> <span class="na">src=</span><span class="s">"static/aaa.ogg"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;source</span> <span class="na">src=</span><span class="s">"static/aaa.webm"</span><span class="nt">&gt;</span>
    您的浏览器版本太低，无法播放，请升级。
<span class="nt">&lt;/video&gt;</span>
</code></pre></div></div>
<h3 id="js">js对象属性</h3>
<p><code>currentTime</code>; 当前播放的时长
<code>duration</code>: 总时长
<code>paused</code>: <code>boolean</code>值，当前视频是否处于暂停状态
<code>volume</code>: 1, 当前音量
<code>playbackRate</code>: 1 播放速率，大于1快放，小于1慢放</p>
<h3 id="js-1">js成员方法</h3>
<ul>
<li><code>play()</code> 播放视频</li>
<li><code>pause()</code> 暂停播放</li>
</ul>
<h3 id="js-2">js成员事件</h3>
<ul>
<li><code>onplay</code>, 当前视频开始播放时触发的事件</li>
<li><code>onpause</code>, 当前视频暂停播放时触发的事件</li>
</ul>
<h2 id="h5-1">3. H5音频</h2>
<p><code>H5</code>提供了一个<code>audio</code>标签用于播放音频，其属性和<code>video</code>几乎一样。</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;audio</span> <span class="na">src=</span><span class="s">"static/stayAlive.mp3"</span> <span class="na">controls</span> <span class="na">autoplay</span><span class="nt">&gt;&lt;/audio&gt;</span>
</code></pre></div></div>
<h1 id="canvas">四、Canvas</h1>
<p>网页中可绘制实时走势图、统计图、在线画图板、网页游戏、地图应用。目前有三种绘图技术。</p>
<ul>
<li><code>SVG</code>绘图，<code>2D</code>矢量图技术，2000就出现了，现属于<code>H5</code>标准</li>
<li><code>Canvas</code>绘图，<code>2D</code>位图技术，<code>H5</code>提出的绘图技术</li>
<li><code>WebGL</code>绘图，<code>3D</code>绘图，尚未纳入<code>H5</code>标准</li>
</ul>
<p>Canvas的学习难点：坐标系、单词比较多</p>
<h2 id="canvas-1">1. Canvas画布</h2>
<p><code>Canvas</code>画布，是<code>H5</code>提供<code>2D</code>绘图技术，其默认是<code>300*150</code>的<code>inline-block</code>，画布的宽高只能使用<code>html/js</code>属性来赋值，不能使用<code>css</code>样式来赋值！</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;canvas</span> <span class="na">width=</span><span class="s">"800"</span> <span class="na">height=</span><span class="s">"600"</span><span class="nt">&gt;</span>您的游览器版本太低，请升级！<span class="nt">&lt;/canvas&gt;</span>
</code></pre></div></div>
<p>每个画布上有且仅有一个“画笔”对象，使用它进行绘图。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>
<p>坐标系：左上角为原点，向右为<code>x</code>轴正方向，向下为<code>y</code>轴正方向</p>
<h2 id="section-4">2. 绘制矩形</h2>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 绘制一个矩形</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// 描边宽度（空心）</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#f00</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// 描边样式（空心）</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#000</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// 填充样式/样色（实心）</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span> <span class="c1">// 描边一个矩形(x,y,w,h)</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span> <span class="c1">// 填充一个矩形</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">//清除一个矩形范围内的所有绘图</span>
</code></pre></div></div>
<h2 id="section-5">3. 绘制文本</h2>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 绘制文本</span>
<span class="kd">let</span> <span class="nx">ctx4</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">c4</span><span class="dl">'</span><span class="p">).</span><span class="nx">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">ctx4</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#080</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">ctx4</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#008</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">ctx4</span><span class="p">.</span><span class="nx">strokeRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">80</span><span class="p">);</span>

<span class="nx">ctx4</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">30px sans-serif</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// 设置字体与大小</span>
<span class="nx">ctx4</span><span class="p">.</span><span class="nx">textBaseline</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">bottom</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// bottom alphabetic 文本基线（垂直对齐方式）</span>
<span class="nx">ctx4</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello, tom</span><span class="dl">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span> <span class="c1">// 在(x,y)坐标位置填充一段文本</span>

<span class="nx">ctx4</span><span class="p">.</span><span class="nx">textBaseline</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">top</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">ctx4</span><span class="p">.</span><span class="nx">strokeText</span><span class="p">(</span><span class="dl">'</span><span class="s1">China</span><span class="dl">'</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// 在(x,y)位置描边一段文本</span>
<span class="kd">let</span> <span class="nx">info</span> <span class="o">=</span> <span class="nx">ctx4</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="dl">'</span><span class="s1">good morning</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// 测量文本宽度，返回对象｛width: x｝</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
</code></pre></div></div>
<h2 id="section-6">4. 渐变对象</h2>
<ul>
<li>线性渐变: <code>linearGradient</code>
<ul>
<li>设置渐变对象</li>
<li>设置颜色点</li>
<li>将渐变对象应用填充或描边样式</li>
<li>画矩形/文本</li>
</ul>
</li>
<li>径向渐变: <code>radialGradient</code></li>
</ul>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">ctx7</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">c7</span><span class="dl">'</span><span class="p">).</span><span class="nx">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// 创建渐变对象(x1,y1, x2, y2)</span>
<span class="kd">let</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">ctx7</span><span class="p">.</span><span class="nx">createLinearGradient</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// 设置颜色点</span>
<span class="nx">g</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="dl">'</span><span class="s1">#008</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">g</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="dl">'</span><span class="s1">#f00</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">g</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="dl">'</span><span class="s1">#080</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// 将该渐变对象设置为画笔填充样式</span>
<span class="nx">ctx7</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">g</span><span class="p">;</span>

<span class="nx">ctx7</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> 
</code></pre></div></div>
<h2 id="section-7">5. 绘制路径</h2>
<p><code>Path</code>: 由多个坐标点组成任意形状，路径本身不可见，可描边、填充、裁剪。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">ctx9</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">c9</span><span class="dl">'</span><span class="p">).</span><span class="nx">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">ctx9</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span> <span class="c1">// 开始路径</span>
<span class="nx">ctx9</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// 移动到指定点(x,y)</span>
<span class="nx">ctx9</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// 从当前点到指定点绘制一条线段</span>
<span class="nx">ctx9</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">110</span><span class="p">);</span>
<span class="nx">ctx9</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">110</span><span class="p">);</span>
<span class="nx">ctx9</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span> <span class="c1">// 闭合路径</span>

<span class="nx">ctx9</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span> <span class="c1">// 绘制圆拱形路径(x,y,r, startArc, endArc)</span>
<span class="nx">ctx9</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
<span class="c1">// ctx9.clip(); // 对当前路径进行裁剪</span>
</code></pre></div></div>
<h2 id="section-8">6. 绘制图像</h2>
<p><code>canvas</code>属于客户端技术，图片在服务器上，所有的浏览器必须先下载，等待图片加载成功以后，再绘制图片。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">img</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span> <span class="c1">// 创建图片对象</span>
<span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">./img/p3.png</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// 加载图片</span>
<span class="c1">// 图片加载完成处理事件</span>
<span class="nx">img</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span> <span class="c1">// 200</span>
    <span class="nx">ctxa</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">img</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span> <span class="c1">// 原大小绘制</span>
    <span class="nx">ctxa</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">img</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span> <span class="c1">// 拉伸绘制</span>
<span class="p">};</span>
</code></pre></div></div>
<h2 id="section-9">7. 异步加载多张图片</h2>
<p><code>Canvas</code>问题：<code>Ajax</code>异步加载，无法预测加载完成顺序。</p>
<p>异步和同步是网络中程序工作方式:</p>
<ul>
<li>同步：有序，（前端工作 后端等待） 与（前端等待 后端工作）</li>
<li>异步：无序，前后端都在工作，不相互等待</li>
</ul>
<p>解决方案：使用整型数字，通过计算完成图片加载。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">progress</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">img1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
<span class="nx">img1</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">1.png</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">img1</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span><span class="o">=&gt;</span><span class="p">{</span>
    <span class="nx">progress</span><span class="o">+=</span><span class="mi">50</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">progress</span> <span class="o">==</span> <span class="mi">100</span><span class="p">)</span> <span class="nx">draw</span><span class="p">();</span>
<span class="p">};</span>
<span class="kd">let</span> <span class="nx">img2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
<span class="nx">img2</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">2.png</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">img2</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span><span class="o">=&gt;</span><span class="p">{</span>
    <span class="nx">progress</span><span class="o">+=</span><span class="mi">50</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">progress</span> <span class="o">==</span> <span class="mi">100</span><span class="p">)</span> <span class="nx">draw</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div></div>
<h2 id="section-10">8. 图形变换操作</h2>
<p><code>canvas</code>可以对一个图像/图形在绘制过程中进行变换，旋转、平移；旋转与平移都具有累加效果。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">angle</span><span class="p">);</span> <span class="c1">//旋转绘图对象，旋转中心是画布原点（0，0）</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span> <span class="c1">//将整个画布的原点平移到指定位置</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span> <span class="c1">//保存画笔的所有变换状态值</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span> <span class="c1">//恢复画布变换状态值到最近一次保存值</span>
</code></pre></div></div>
<h1 id="svg">五、SVG绘图</h1>
<p>| |canvas绘图| svg绘图|
|-|-|-|
|类型| <code>2D</code>位图| <code>2D</code>矢量图|
|如何绘图| 使用<code>JS</code>代码绘图| 使用标签绘图|
|事件绑定| 每个图形不是元素，不能直接绑定事件| 每个图形都是元素，可以直接绑定事件|
|应用场合| 游戏，特效| 地图，图标|</p>
<p><code>SVG</code>诞生于2000年，早期作为<code>XML</code>的扩展应用，<code>H5</code>标准将常用的<code>SVG</code>标签采纳为标准。</p>
<ul>
<li><code>SVG</code>技术在<code>H5</code>之前使用方法
<ul>
<li>在一个<code>XML</code>文档声明绘制图形</li>
<li>再编写<code>HTML</code>文档，使用<code>IMG/OBJECT</code>应用</li>
</ul>
</li>
<li><code>SVG</code>技术在<code>H5</code>出现之后使用方法
<ul>
<li>直接在<code>H5</code>文档中使用<code>SVG</code>标准</li>
</ul>
</li>
</ul>
<p><code>&lt;svg&gt;&lt;/svg&gt;</code>本身是一个默认<code>300*150</code>的<code>inline-block</code>，可以绘制
<code>&lt;rect&gt;</code>矩形，<code>&lt;circle&gt;</code>圆形，<code>&lt;ellipse&gt;</code>椭圆，<code>&lt;line&gt;</code>直线，<code>&lt;polyline&gt;</code>折线，<code>&lt;polygon&gt;</code>多边形，<code>&lt;text&gt;</code>文本，图像</p>
<p><code>&lt;g&gt;</code>分组标签，内部可以含有多个图形标签，并且可以在它上面指定共有属性值。</p>
<p>绘制复杂图形：贝塞尔曲线，路径（<code>path</code>）。</p>
<h2 id="section-11">1.绘制矩形</h2>
<p><code>&lt;rect&gt;&lt;/rect&gt;</code>，属性包括：</p>
<ul>
<li><code>width</code></li>
<li><code>height</code></li>
<li><code>x</code></li>
<li><code>y</code></li>
<li><code>fill</code></li>
<li><code>fill-opacity</code></li>
<li><code>stroke</code></li>
<li><code>stroke-width</code></li>
<li><code>stroke-opacity</code></li>
</ul>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;svg</span> <span class="na">id=</span><span class="s">"s1"</span> <span class="na">width=</span><span class="s">"600"</span> <span class="na">height=</span><span class="s">"400"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rect</span> <span class="na">width=</span><span class="s">"100"</span> <span class="na">height=</span><span class="s">"100"</span><span class="nt">&gt;&lt;/rect&gt;</span>
    <span class="nt">&lt;rect</span> <span class="na">width=</span><span class="s">"100"</span> <span class="na">height=</span><span class="s">"100"</span> <span class="na">x=</span><span class="s">"400"</span> <span class="na">y=</span><span class="s">"0"</span> <span class="na">stroke=</span><span class="s">"#088"</span> <span class="na">stroke-width=</span><span class="s">"3"</span> <span class="na">fill=</span><span class="s">"transparent"</span><span class="nt">&gt;&lt;/rect&gt;</span>
    <span class="nt">&lt;rect</span> <span class="na">width=</span><span class="s">"100"</span> <span class="na">height=</span><span class="s">"100"</span> <span class="na">x=</span><span class="s">"0"</span> <span class="na">y=</span><span class="s">"300"</span> <span class="na">fill=</span><span class="s">"#f00"</span> <span class="na">fill-opacity=</span><span class="s">"0.5"</span><span class="nt">&gt;&lt;/rect&gt;</span>
<span class="nt">&lt;/svg&gt;</span>
</code></pre></div></div>
<h2 id="section-12">2. 绘制圆形</h2>
<p><code>&lt;circle&gt;&lt;/circle&gt;</code>，属性包括:</p>
<ul>
<li><code>cx</code></li>
<li><code>cy</code></li>
<li><code>r</code></li>
<li><code>fill</code></li>
<li><code>fill-opacity</code></li>
<li><code>stroke</code></li>
<li><code>stroke-opacity</code></li>
</ul>
<h2 id="section-13">3. 绘制椭圆</h2>
<p><code>&lt;cllipse cx=&quot;&quot; cy=&quot;&quot; rx=&quot;&quot; ry=&quot;&quot;&gt;&lt;/ellipse&gt;</code></p>
<p><code>rx</code>: 水平半径
<code>ry</code>: 垂直半径</p>
<h2 id="section-14">4. 绘制直线</h2>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;g</span> <span class="na">stroke=</span><span class="s">"#222"</span> <span class="na">stroke-width=</span><span class="s">"8"</span> <span class="na">stroke-linecap=</span><span class="s">"round"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;line</span> <span class="na">x1=</span><span class="s">"60"</span> <span class="na">y1=</span><span class="s">"200"</span> <span class="na">x2=</span><span class="s">"70"</span> <span class="na">y2=</span><span class="s">"200"</span> <span class="nt">&gt;&lt;/line&gt;</span>
    <span class="nt">&lt;line</span> <span class="na">x1=</span><span class="s">"60"</span> <span class="na">y1=</span><span class="s">"220"</span> <span class="na">x2=</span><span class="s">"70"</span> <span class="na">y2=</span><span class="s">"220"</span> <span class="nt">&gt;&lt;/line&gt;</span>
    <span class="nt">&lt;line</span> <span class="na">x1=</span><span class="s">"60"</span> <span class="na">y1=</span><span class="s">"240"</span> <span class="na">x2=</span><span class="s">"70"</span> <span class="na">y2=</span><span class="s">"240"</span> <span class="nt">&gt;&lt;/line&gt;</span>
    <span class="nt">&lt;line</span> <span class="na">x1=</span><span class="s">"85"</span> <span class="na">y1=</span><span class="s">"200"</span> <span class="na">x2=</span><span class="s">"140"</span> <span class="na">y2=</span><span class="s">"200"</span> <span class="nt">&gt;&lt;/line&gt;</span>
    <span class="nt">&lt;line</span> <span class="na">x1=</span><span class="s">"85"</span> <span class="na">y1=</span><span class="s">"220"</span> <span class="na">x2=</span><span class="s">"140"</span> <span class="na">y2=</span><span class="s">"220"</span> <span class="nt">&gt;&lt;/line&gt;</span>
    <span class="nt">&lt;line</span> <span class="na">x1=</span><span class="s">"85"</span> <span class="na">y1=</span><span class="s">"240"</span> <span class="na">x2=</span><span class="s">"140"</span> <span class="na">y2=</span><span class="s">"240"</span> <span class="nt">&gt;&lt;/line&gt;</span>
<span class="nt">&lt;/g&gt;</span>
</code></pre></div></div>
<h2 id="section-15">5. 绘制折线</h2>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;polyline</span> <span class="na">points=</span><span class="s">"50,50 100,50 100,100 50,100"</span> 
<span class="na">fill=</span><span class="s">"transparent"</span> <span class="na">stroke=</span><span class="s">"#444"</span> <span class="na">stroke-width=</span><span class="s">"2"</span><span class="nt">&gt;&lt;/polyline&gt;</span>
</code></pre></div></div>
<h2 id="section-16">6. 绘制多边形</h2>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;polyline</span> <span class="na">points=</span><span class="s">"100,100 115,150 77,120 123,120 85,150 100,100"</span> 
<span class="na">fill=</span><span class="s">"#080"</span> <span class="na">stroke=</span><span class="s">"#008"</span> <span class="na">stroke-width=</span><span class="s">"2"</span><span class="nt">&gt;&lt;/polyline&gt;</span>
</code></pre></div></div>
<h2 id="section-17">7. 绘制文本</h2>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;text</span> <span class="na">font-size=</span><span class="s">"48"</span> <span class="na">fill=</span><span class="s">"#088"</span> <span class="na">stroke=</span><span class="s">"#f00"</span> 
<span class="na">x=</span><span class="s">"50"</span> <span class="na">y=</span><span class="s">"50"</span> <span class="na">alignment-baseline=</span><span class="s">"before-edge"</span><span class="nt">&gt;</span>
hello,汉字
<span class="nt">&lt;/text&gt;</span>
</code></pre></div></div>
<h2 id="section-18">8. 绘制图像</h2>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;image</span> <span class="na">xlink:href=</span><span class="s">"./img/play.png"</span> 
<span class="na">width=</span><span class="s">"300"</span> <span class="na">height=</span><span class="s">"200"</span> <span class="na">x=</span><span class="s">"150"</span> <span class="na">y=</span><span class="s">"100"</span><span class="nt">&gt;&lt;/image&gt;</span>
</code></pre></div></div>
<h2 id="section-19">9. 渐变对象</h2>
<p>使用<code>linearGradient</code>标签，定义<code>id</code>，并使用；它属于特效，放在<code>defs</code>标签内。</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;svg</span> <span class="na">id=</span><span class="s">"se"</span> <span class="na">width=</span><span class="s">"600"</span> <span class="na">height=</span><span class="s">"400"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;defs&gt;</span>
        <span class="nt">&lt;linearGradient</span> <span class="na">id=</span><span class="s">"ge"</span> <span class="na">x1=</span><span class="s">"0%"</span> <span class="na">y1=</span><span class="s">"0%"</span> <span class="na">x2=</span><span class="s">"100%"</span> <span class="na">y2=</span><span class="s">"100%"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;stop</span> <span class="na">offset=</span><span class="s">"0%"</span> <span class="na">style=</span><span class="s">"stop-color:rgb(255,255,0);stop-opacity:1"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;stop</span> <span class="na">offset=</span><span class="s">"100%"</span> <span class="na">style=</span><span class="s">"stop-color:rgb(255,0,0);stop-opacity:1"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/linearGradient&gt;</span>
    <span class="nt">&lt;/defs&gt;</span>
    <span class="nt">&lt;rect</span> <span class="na">x=</span><span class="s">"0"</span> <span class="na">y=</span><span class="s">"0"</span> <span class="na">width=</span><span class="s">"300"</span> <span class="na">height=</span><span class="s">"200"</span> <span class="na">fill=</span><span class="s">"url(#ge)"</span> <span class="nt">&gt;&lt;/rect&gt;</span>
    <span class="nt">&lt;circle</span> <span class="na">cx=</span><span class="s">"100"</span> <span class="na">cy=</span><span class="s">"100"</span> <span class="na">r=</span><span class="s">"50"</span> <span class="na">fill=</span><span class="s">"url(#ge)"</span><span class="nt">&gt;&lt;/circle&gt;</span>
    <span class="nt">&lt;text</span> <span class="na">font-size=</span><span class="s">"60"</span> <span class="na">x=</span><span class="s">"0"</span> <span class="na">y=</span><span class="s">"300"</span> <span class="na">fill=</span><span class="s">"url(#ge)"</span><span class="nt">&gt;</span>快乐每一天<span class="nt">&lt;/text&gt;</span>
<span class="nt">&lt;/svg&gt;</span>
</code></pre></div></div>
<h2 id="section-20">10. 滤镜</h2>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;svg</span> <span class="na">id=</span><span class="s">"sg"</span> <span class="na">width=</span><span class="s">"600"</span> <span class="na">height=</span><span class="s">"400"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;defs&gt;</span>
        <span class="nt">&lt;filter</span> <span class="na">id=</span><span class="s">"sf1"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;feGaussianBlur</span> <span class="na">stdDeviation=</span><span class="s">"3"</span><span class="nt">&gt;&lt;/feGaussianBlur&gt;</span>
        <span class="nt">&lt;/filter&gt;</span>            
    <span class="nt">&lt;/defs&gt;</span>
    <span class="nt">&lt;circle</span> <span class="na">cx=</span><span class="s">"150"</span> <span class="na">cy=</span><span class="s">"150"</span> <span class="na">r=</span><span class="s">"50"</span> <span class="na">fill=</span><span class="s">"#f40"</span> <span class="na">filter=</span><span class="s">"url(#sf1)"</span><span class="nt">&gt;&lt;/circle&gt;</span>
    <span class="nt">&lt;circle</span> <span class="na">cx=</span><span class="s">"150"</span> <span class="na">cy=</span><span class="s">"300"</span> <span class="na">r=</span><span class="s">"50"</span> <span class="na">fill=</span><span class="s">"#f40"</span><span class="nt">&gt;&lt;/circle&gt;</span>
<span class="nt">&lt;/svg&gt;</span>
</code></pre></div></div>
<h2 id="section-21">第三方库</h2>
<p>使用<code>canvas</code>/<code>svg</code>/<code>webGL</code>，一些第三方库可以帮助我们快速完成某些功能，如:</p>
<ul>
<li><code>tow.js</code>，一个2D绘图函数库，提供了一套<code>API</code>，可以用于绘制各种图形（<code>canvas</code>/<code>svg</code>/<code>webGL</code>）。</li>
<li><code>echarts.js</code>，百度开发，对地图支持比较好</li>
<li><code>animate.css</code></li>
<li><code>three.js</code></li>
<li><code>d3.js</code></li>
</ul>
<h1 id="section-22">六、地理定位</h1>
<p><code>Geolocation</code>: 地理定位，使用<code>JS</code>获取当前浏览器所在地理坐标（经度、纬度、海拔、速度）数据用于实现应用，如饿了么、高德导航。</p>
<p>手机浏览器如何获取定位信息（应用较多）</p>
<ul>
<li>首选手机中<code>GPS</code>芯片与卫星通信，定位精度在米</li>
<li>次选手机通信基站进行定位获取，定位精度低（公里）</li>
</ul>
<p><code>PC</code>浏览器如何获取定位信息</p>
<ul>
<li>通过<code>IP</code>地址进行反向解析，定位精度取决于<code>IP</code>库，通常误差大</li>
</ul>
<h2 id="navigatorgeolocation">使用navigator.geolocation</h2>
<p><code>H5</code>中提供了一个新对象，用于获取当前浏览器定位信息。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">geolocation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getCurrentPosition</span><span class="p">,</span> <span class="c1">// 获取定位信息</span>
    <span class="nx">watchPosition</span><span class="p">,</span> <span class="c1">// 监听定位数据的改变</span>
    <span class="nx">clearWatch</span> <span class="c1">// 去除监听</span>
<span class="p">};</span>
</code></pre></div></div>
<p>但是这个功能并不实用，比如在<code>chrome</code>浏览器中会收到<code>Network location provider at 'https://www.googleapis.com/' : No response received.</code>错误，无法获得有效的定位信息。</p>
<h2 id="section-23">使用百度地图</h2>
<ul>
<li>注册百度开发者账户</li>
<li>创建一个网站，登录百度地图，为该网站申请<code>AccessKey</code></li>
<li>在自己的网页中嵌入百度地图提供的<code>API</code></li>
</ul>
<h1 id="api">七、拖放API</h1>
<p><code>Drag and Drop</code>,拖动和释放，<code>H5</code>提供了7个事件。</p>
<p>拖动源对象（会移动），会触发的事件:</p>
<ul>
<li><code>dragstart</code></li>
<li><code>drag</code></li>
<li><code>dragend</code></li>
</ul>
<p>拖动的目标对象，会触发的事件:</p>
<ul>
<li><code>dragenter</code></li>
<li><code>dragover</code></li>
<li><code>dragleave</code></li>
<li><code>drop</code></li>
</ul>
<p>拖动整体过程：</p>
<ul>
<li><code>dragenter*1 + dragover*n + drageleave*1</code></li>
<li><code>dragenter*1 + dragover*n + drop*1</code></li>
</ul>
<p>必须阻止<code>dragover</code>的默认行为（一旦悬停立即离开）</p>
<h1 id="webworker">八、WebWorker</h1>
<ul>
<li>进程：操作系统分配内存的单位（工厂）</li>
<li>线程：处理进程内部，用于执行代码（生产线）</li>
<li>线程并发：操作系统中所有的线程宏观上看“同时执行”，微观上看是“依次交替执行”</li>
</ul>
<h2 id="section-24">单线程的问题</h2>
<p><code>chrome</code>中线程的模型：请求资源，6个线程；运行代码、渲染内容，1个线程。</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button&gt;</span>按钮一<span class="nt">&lt;/button&gt;</span>
<span class="c">&lt;!-- 下面这个js执行很长时间的话，会导致页面阻塞 --&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./js/1.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;button&gt;</span>按钮二<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div>
<h2 id="section-25">解决方法</h2>
<ol>
<li>将所有的<code>js</code>程序的执行放在<code>&lt;/body&gt;</code>前，作为最后一个元素</li>
<li>创建新的线程，由它来执行耗时的<code>js</code>任务，<code>UI</code>的主线程继续执行后续的<code>HTML</code>的渲染</li>
</ol>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">w</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="dl">'</span><span class="s1">./js/1.js</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>
<h2 id="section-26">缺陷</h2>
<p>浏览器不允许<code>Worker</code>线程操作<code>DOM</code>/<code>BOM</code>元素的操作。</p>
<p>原因：浏览器只允许<code>UI</code>主线程操作<code>DOM</code>/<code>BOM</code>，若多个<code>Worker</code>线程同时操作<code>DOM</code>结构的话，会造成页面的混乱。</p>
<h2 id="section-27">数据传输</h2>
<p><code>Worker</code>线程可以给<code>UI</code>主线程发送数据</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// UI主线程</span>
<span class="kd">let</span> <span class="nx">w</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="dl">'</span><span class="s1">1.js</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">w</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">};</span>

<span class="c1">// Worker线程</span>
<span class="nx">postMessage</span><span class="p">(</span><span class="nx">StringMsg</span><span class="p">);</span>
</code></pre></div></div>
<p><code>UI</code>主线程也可以给<code>Worker</code>线程发送数据</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// UI主线程</span>
<span class="kd">let</span> <span class="nx">w</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="dl">'</span><span class="s1">1.js</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">w</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">stringMsg</span><span class="p">);</span>

<span class="c1">// Worker线程</span>
<span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">};</span>
</code></pre></div></div>
<h1 id="web-storage">九、Web Storage</h1>
<p>在浏览器中存储当前用户专用的数据：访问历史、购物车、内容定制、样式定制...</p>
<h2 id="section-28">客户端存储技术</h2>
<ul>
<li><code>Cookie</code>技术；浏览器兼容性好，一个<code>Cookie</code>不能超过4KB，老浏览器对<code>Cookie</code>个数也有限制（&lt;=30），操作复杂</li>
<li><code>Flash</code>存储：依赖于<code>Flash</code>播放器，用的比较少了</li>
<li><code>H5 WebStorage</code>：不能超过8MB（标准，实际可能小写），操作简单，比较新</li>
<li><code>IndexDB</code>：可存储大量数据，还不是标准</li>
</ul>
<h2 id="webstorage">WebStorage</h2>
<p><code>WebStorage</code>技术中，浏览器为用户提供两个对象：</p>
<h3 id="windowsessionstorage">window.sessionStorage</h3>
<p>类数组对象，会话级别数据存储。浏览器进程所分得内存中存储一次<code>WEB</code>会话的数据，可供本次会话的页面共同使用，浏览器一旦关闭就消失。</p>
<p><code>Session</code>：会话，浏览器从打开某个网站的一个页面开始，中间可能打开很多个页面，直到关闭浏览器，整个过程称为浏览器与<code>WEB</code>服务器的一次会话。</p>
<p>作用：在同一个会话中所有的页面之间共享的数据，例如登录用户名/登录用户编号（通常存编号，否则中文用户名可能导致错误）。</p>
<p>|操作|API|
|-|-|
|存数据| <code>sessionStorage[key] = val;</code>|
| | <code>sessionStorage.setItem(key, val);</code>|
|读取数据| <code>let val = sessionStorage[key];</code>|
| | <code>let val = sessionStorage.getItem(key);</code>|
|清除指定数据| <code>sessionStorage.removeItem(key);</code>|
|清空所有数据| <code>sessionStorage.clear();</code>|
|数据个数| <code>let len = sessionStorage.length;</code>|
|获取第<code>i</code>个<code>key</code>| <code>let key = sessionStorage.key[i];</code>|</p>
<h3 id="windowlocalstorage">window.localStorage</h3>
<p>本地存储对象，跨会话级存储。在浏览器能管理外存（磁盘），可在其中存储用户数据，可供此次会话及后续会话的页面共同使用；即使浏览器关闭了，也不会消失，永久存在。</p>
<p>作用：存储用户样式风格（比如<code>qq</code>空间）</p>
<p>|操作           |API|
|-              |-      |
|存数据         | <code>localStorage[key] = val;</code>|
|               | <code>localStorage.setItem(key, val);</code>|
|读取数据       | <code>let val = localStorage[key];</code>|
|               | <code>let val = localStorage.getItem(key);</code>|
|清除指定数据   | <code>localStorage.removeItem(key);</code>|
|清空所有数据   | <code>localStorage.clear();</code>|
|数据个数       | <code>let len = localStorage.length;</code>|
|获取第i个key   | <code>let key = localStorage.key[i];</code>|</p>
<p><code>localStorage</code>中若数据发生了修改，会触发事件<code>window.onstorage</code>，可以监听事件，可以监视<code>localStorage</code>数据改变（注意<code>sessionStorage</code>没有此功能；<code>chrome</code>浏览器中，该事件只能被其他页面触发，不能被当前页面触发）。</p>
<h1 id="websocket">十、WebSocket</h1>
<h2 id="http">http协议</h2>
<p><code>HTTP</code>协议，属于“请求-响应”模型，只有客户端发起请求消息，服务器才会返回响应消息，没有请求就没有响应，一个请求也只能 得到一个响应；这在有些场景下很不方便（如实时走势应用）。</p>
<p>解决方案：长轮询（<code>Long-Polling</code>）/心跳请求，定时器+<code>ajax</code>，请求太频繁，服务器压力大，不够频繁，客户端数据延迟太大。</p>
<h2 id="websocket-1">WebSocket协议</h2>
<p><code>WebSocket</code>，作为<code>HTTP</code>的补充，属于“广播-收听”模型，客户端连接到就不再断开，持续连接，双方随时向对方发送消息，且是全双工、不对等发送。</p>
<p><code>ws</code>协议分为客户端和服务器端程序。客户端应用主动发起连接请求，保持连接，向对方发送消息，并接收消息。客户端可以是<code>php</code>、<code>java</code>、<code>nodejs</code>、<code>html5</code>。</p>
<h2 id="h5ws">使用H5创建ws协议客户端应用</h2>
<ul>
<li>连接<code>ws</code>服务器</li>
<li>向服务器发送消息</li>
<li>接收服务器发来的消息</li>
<li>断开到<code>ws</code>服务器的连接（可选）</li>
</ul>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="dl">'</span><span class="s1">ws://127.0.0.1:9001</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</code></pre></div></div>

				</div>
				<p>（本文完）</p>

				<p class="license">
					<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />本作品采用<a
					 rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享署名-非商业性使用-相同方式共享
						4.0 国际许可协议</a>进行许可。
				</p>
			</article>
		</div>

	</div>

	<script src="https://cdn.bootcss.com/vue/2.5.21/vue.min.js"></script>
	<script src="/js/article.js"></script>
</body>

</html>